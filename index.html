<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order Up!</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    :root{--bg:#1a0a12;--card:#2a1020;--card2:#331525;--border:#5a2040;--pink:#ff69b4;--pink2:#ff1493;--pink-light:#ffb6d9;--pink-glow:rgba(255,105,180,0.15);--green:#a8ff78;--red:#ff6b6b;--text:#ffe0f0;--muted:#c080a0;}
    *{box-sizing:border-box;margin:0;padding:0;}
    body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;}
    body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;background:radial-gradient(ellipse at 20% 20%,rgba(255,20,147,0.07) 0%,transparent 50%),radial-gradient(ellipse at 80% 80%,rgba(255,105,180,0.05) 0%,transparent 50%),linear-gradient(rgba(255,105,180,0.02) 1px,transparent 1px),linear-gradient(90deg,rgba(255,105,180,0.02) 1px,transparent 1px);background-size:100% 100%,100% 100%,44px 44px,44px 44px;}
    .page{position:relative;z-index:1;}
    .hidden{display:none!important;}
    ::-webkit-scrollbar{width:5px;}
    ::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px;}

    /* VERSION BANNER */
    #version-banner{position:fixed;top:14px;right:14px;z-index:10000;background:linear-gradient(135deg,var(--pink),var(--pink2));color:#fff;font-size:12px;font-weight:700;letter-spacing:1px;padding:7px 14px;border-radius:22px;box-shadow:0 4px 20px rgba(255,20,147,0.45);display:flex;align-items:center;gap:8px;cursor:pointer;transition:opacity .35s,transform .35s;animation:vbIn .7s cubic-bezier(.34,1.56,.64,1) both;}
    #version-banner.gone{opacity:0;transform:translateY(-10px);pointer-events:none;}
    @keyframes vbIn{from{opacity:0;transform:translateY(-16px);}to{opacity:1;transform:translateY(0);}}
    .vb-dot{width:7px;height:7px;border-radius:50%;background:rgba(255,255,255,0.9);flex-shrink:0;animation:vbPulse 1.4s infinite;}
    @keyframes vbPulse{0%,100%{opacity:1;transform:scale(1);}50%{opacity:.4;transform:scale(.7);}}
    .vb-x{opacity:.65;font-size:11px;margin-left:3px;}

    #landing{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:40px 20px;text-align:center;}
    .logo{font-family:'Playfair Display',serif;font-weight:900;font-size:clamp(60px,13vw,110px);letter-spacing:-2px;line-height:0.95;margin-bottom:10px;background:linear-gradient(135deg,#ffb6d9,var(--pink),var(--pink2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;filter:drop-shadow(0 0 28px rgba(255,105,180,0.35));}
    .logo-sub{font-family:'Playfair Display',serif;font-size:clamp(14px,3vw,22px);color:var(--pink-light);letter-spacing:5px;text-transform:uppercase;margin-bottom:44px;opacity:0.75;}
    .role-cards{display:flex;gap:18px;flex-wrap:wrap;justify-content:center;}
    .role-card{background:var(--card);border:2px solid var(--border);border-radius:20px;padding:34px 44px;cursor:pointer;transition:all .22s;min-width:180px;text-align:center;position:relative;overflow:hidden;}
    .role-card::after{content:'';position:absolute;inset:0;background:var(--pink-glow);opacity:0;transition:opacity .22s;}
    .role-card:hover{border-color:var(--pink);transform:translateY(-5px);box-shadow:0 20px 48px rgba(255,20,147,0.18);}
    .role-card:hover::after{opacity:1;}
    .role-card .ico{font-size:42px;margin-bottom:12px;}
    .role-card h2{font-family:'Playfair Display',serif;font-size:22px;margin-bottom:6px;color:var(--pink-light);}
    .role-card p{color:var(--muted);font-size:12px;}
    .join-box{margin-top:28px;background:var(--card);border:2px solid var(--border);border-radius:16px;padding:22px 28px;display:flex;flex-direction:column;align-items:center;gap:12px;min-width:280px;}
    .join-box label{color:var(--muted);font-size:11px;letter-spacing:3px;text-transform:uppercase;}
    .join-row{display:flex;gap:8px;width:100%;}
    input[type=text]{background:#100010;border:2px solid var(--border);color:var(--text);padding:11px 15px;border-radius:10px;font-size:15px;font-family:'DM Sans',sans-serif;outline:none;transition:border-color .2s;}
    input[type=text]:focus{border-color:var(--pink);box-shadow:0 0 0 3px rgba(255,105,180,0.12);}
    .btn{padding:11px 22px;border:none;border-radius:10px;font-size:14px;font-family:'DM Sans',sans-serif;font-weight:700;cursor:pointer;transition:all .18s;}
    .btn-primary{background:linear-gradient(135deg,var(--pink),var(--pink2));color:#fff;box-shadow:0 4px 14px rgba(255,20,147,0.28);}
    .btn-primary:hover{transform:translateY(-2px);box-shadow:0 8px 22px rgba(255,20,147,0.42);filter:brightness(1.08);}
    .btn-primary:disabled{opacity:.4;cursor:not-allowed;transform:none;filter:none;}
    .btn-ghost{background:transparent;border:2px solid var(--border);color:var(--text);}
    .btn-ghost:hover{border-color:var(--pink);color:var(--pink);}
    .btn-outline{background:transparent;border:2px solid var(--pink);color:var(--pink);}
    .btn-outline:hover{background:var(--pink-glow);}

    #name-screen{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:40px 20px;text-align:center;}
    #name-screen h2{font-family:'Playfair Display',serif;font-size:38px;color:var(--pink-light);margin-bottom:8px;}
    #name-screen p{color:var(--muted);margin-bottom:28px;}
    .name-form{display:flex;flex-direction:column;gap:11px;width:100%;max-width:290px;}
    .name-form input{text-align:center;font-size:18px;}

    #host-lobby{display:flex;flex-direction:column;align-items:center;min-height:100vh;padding:28px 20px;}
    .top-bar{width:100%;max-width:880px;display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;}
    .badge{background:linear-gradient(135deg,var(--pink),var(--pink2));color:#fff;font-size:12px;font-weight:700;letter-spacing:2px;text-transform:uppercase;padding:5px 13px;border-radius:20px;}
    .badge.player-badge{background:linear-gradient(135deg,#a855f7,#ec4899);}
    .room-code-block{text-align:center;margin-bottom:26px;}
    .room-code-block label{display:block;color:var(--muted);font-size:11px;letter-spacing:3px;text-transform:uppercase;margin-bottom:7px;}
    .room-code{font-family:'Playfair Display',serif;font-size:60px;letter-spacing:10px;color:var(--pink);line-height:1;text-shadow:0 0 28px rgba(255,105,180,0.35);}
    .lobby-grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;width:100%;max-width:880px;}
    @media(max-width:640px){.lobby-grid{grid-template-columns:1fr;}}
    .panel{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:20px;}
    .panel h3{font-family:'Playfair Display',serif;font-size:16px;color:var(--pink-light);margin-bottom:13px;}
    #qr-wrap{display:flex;justify-content:center;margin-bottom:11px;}
    #qr-inner{background:#fff;padding:10px;border-radius:10px;display:inline-block;border:3px solid var(--pink);}
    .join-url{word-break:break-all;font-size:10px;color:var(--muted);text-align:center;background:#100010;padding:7px 10px;border-radius:6px;}
    .player-list{display:flex;flex-direction:column;gap:7px;min-height:48px;}
    .player-item{display:flex;align-items:center;gap:10px;background:var(--card2);border-radius:9px;padding:9px 13px;animation:slideIn .28s ease;}
    @keyframes slideIn{from{opacity:0;transform:translateX(-7px);}to{opacity:1;transform:translateX(0);}}
    .p-avatar{width:30px;height:30px;border-radius:50%;background:rgba(255,105,180,0.12);display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0;border:1px solid var(--border);}
    .p-name{font-weight:600;font-size:13px;flex:1;}
    .p-score{font-size:12px;color:var(--pink);font-weight:700;}
    .pulse-dot{width:7px;height:7px;border-radius:50%;background:var(--pink);animation:pdp 1.5s infinite;}
    @keyframes pdp{0%,100%{opacity:1;}50%{opacity:.2;}}
    .no-players{color:var(--muted);text-align:center;padding:20px;font-size:13px;}

    #host-pick-screen{display:flex;flex-direction:column;align-items:center;min-height:100vh;padding:24px 20px;}
    .cat-search{width:100%;max-width:900px;margin-bottom:11px;}
    .cat-search input{width:100%;}
    .cat-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(195px,1fr));gap:9px;width:100%;max-width:900px;margin-bottom:18px;max-height:60vh;overflow-y:auto;padding:4px;}
    .cat-card{background:var(--card);border:2px solid var(--border);border-radius:11px;padding:13px 16px;cursor:pointer;transition:all .17s;}
    .cat-card:hover{border-color:var(--pink);background:var(--card2);transform:translateY(-2px);}
    .cat-card.selected{border-color:var(--pink2);background:rgba(255,20,147,0.1);box-shadow:0 0 14px rgba(255,20,147,0.18);}
    .cat-card.used{opacity:.3;cursor:not-allowed;pointer-events:none;}
    .cat-type{font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:4px;}
    .cat-name{font-family:'Playfair Display',serif;font-size:14px;color:var(--pink-light);margin-bottom:5px;}
    .cat-items{font-size:10px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}

    /* GAME LAYOUT */
    .game-wrap{display:flex;flex-direction:column;align-items:center;min-height:100vh;padding:24px 20px;}
    .game-head{text-align:center;margin-bottom:14px;}
    .game-head h1{font-family:'Playfair Display',serif;font-size:26px;color:var(--pink-light);margin-bottom:3px;}
    .game-head p{color:var(--muted);font-size:12px;}
    .cat-label{background:var(--card);border:1px solid var(--border);border-radius:20px;padding:5px 16px;font-size:12px;color:var(--pink-light);letter-spacing:.5px;margin-bottom:12px;}
    .locked-bar{background:rgba(255,20,147,0.07);border:1px solid var(--pink2);color:var(--pink-light);border-radius:9px;padding:9px 18px;font-size:12px;text-align:center;margin-bottom:12px;max-width:460px;width:100%;}
    .rank-labels{display:flex;justify-content:space-between;max-width:460px;width:100%;margin-bottom:6px;padding:0 2px;}
    .rl{font-size:10px;font-weight:700;letter-spacing:1px;text-transform:uppercase;}
    .rl.top{color:var(--pink);}
    .rl.bot{color:var(--muted);}
    .round-badge{background:var(--card2);border:1px solid var(--border);border-radius:20px;padding:4px 12px;font-size:12px;color:var(--muted);}
    .tap-hint{font-size:11px;color:var(--muted);text-align:center;margin-bottom:10px;max-width:460px;width:100%;}
    .tap-hint b{color:var(--pink);}

    /* TAP-TO-RANK */
    .rank-arena{display:flex;gap:12px;width:100%;max-width:460px;align-items:flex-start;}
    .rank-slots{display:flex;flex-direction:column;gap:5px;flex:1;min-width:0;}
    .rank-slot{display:flex;align-items:center;gap:9px;min-height:50px;background:var(--card);border:2px dashed var(--border);border-radius:11px;padding:9px 12px;transition:border-color .15s,background .15s;cursor:default;}
    .rank-slot.slot-ready{border-color:rgba(255,105,180,.5);border-style:dashed;background:rgba(255,20,147,.04);}
    .rank-slot.filled{border-style:solid;}
    .rank-slot.filled.slot-ready{border-color:var(--pink);}
    .slot-num{font-family:'Playfair Display',serif;font-size:19px;font-weight:700;width:22px;text-align:center;flex-shrink:0;}
    .slot-name{font-size:13px;font-weight:600;flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
    .slot-empty{font-size:11px;color:var(--muted);flex:1;font-style:italic;}
    .slot-remove{font-size:12px;color:var(--muted);cursor:pointer;padding:3px 5px;border-radius:4px;flex-shrink:0;transition:color .15s;}
    .slot-remove:hover{color:var(--red);}

    /* ITEM POOL */
    .item-pool{display:flex;flex-direction:column;gap:5px;width:130px;flex-shrink:0;}
    @media(max-width:400px){.item-pool{width:110px;}}
    .pool-label{font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);text-align:center;margin-bottom:3px;}
    .pool-item{background:var(--card2);border:2px solid var(--border);border-radius:9px;padding:8px 10px;font-size:12px;font-weight:600;cursor:pointer;transition:all .15s;text-align:center;line-height:1.25;word-break:break-word;}
    .pool-item:active{transform:scale(.97);}
    .pool-item:hover{border-color:var(--pink);background:rgba(255,105,180,.08);}
    .pool-item.sel{border-color:var(--pink2);background:rgba(255,20,147,.14);box-shadow:0 0 10px rgba(255,20,147,.22);}

    /* STATIC RESULTS LIST */
    .slist{list-style:none;max-width:420px;width:100%;}
    .slist li{display:flex;align-items:center;gap:11px;padding:12px 14px;margin-bottom:6px;background:var(--card);border:2px solid var(--border);border-radius:11px;position:relative;overflow:hidden;}
    .slist li.correct{border-color:var(--green)!important;background:rgba(168,255,120,.07)!important;}
    .slist li.wrong{border-color:var(--red)!important;background:rgba(255,107,107,.07)!important;}
    .stripe{position:absolute;left:0;top:0;bottom:0;width:4px;}
    .rnum{font-family:'Playfair Display',serif;font-size:19px;font-weight:700;width:24px;text-align:center;flex-shrink:0;}
    .iname{font-size:14px;font-weight:600;flex:1;}
    .res-host-pos{font-size:10px;color:var(--muted);margin-left:auto;margin-right:4px;}
    .res-check{font-size:15px;}

    #waiting-screen{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:40px 20px;text-align:center;}
    .spinner{width:50px;height:50px;border:4px solid var(--border);border-top-color:var(--pink);border-radius:50%;animation:spin .85s linear infinite;margin-bottom:22px;}
    @keyframes spin{to{transform:rotate(360deg);}}

    #round-results-screen{display:flex;flex-direction:column;align-items:center;padding:32px 20px;min-height:100vh;}
    .rr-title{font-family:'Playfair Display',serif;font-size:40px;color:var(--pink-light);margin-bottom:3px;text-align:center;}
    .your-score-box{background:var(--card);border:2px solid var(--pink);border-radius:14px;padding:16px 32px;text-align:center;margin:14px 0;}
    .score-num{font-family:'Playfair Display',serif;font-size:52px;color:var(--pink);line-height:1;}
    .score-label{color:var(--muted);font-size:12px;margin-top:3px;}
    .result-section-title{color:var(--pink-light);font-size:13px;font-weight:700;margin-bottom:8px;text-align:center;}
    .lb{width:100%;max-width:480px;margin-top:10px;}
    .lb h3{font-family:'Playfair Display',serif;font-size:18px;color:var(--pink-light);margin-bottom:11px;text-align:center;}
    .lb-item{display:flex;align-items:center;gap:12px;background:var(--card);border:1px solid var(--border);border-radius:11px;padding:11px 15px;margin-bottom:7px;animation:slideIn .4s ease both;}
    .lb-pos{font-family:'Playfair Display',serif;font-size:22px;width:32px;text-align:center;}
    .lb-name{flex:1;font-weight:600;font-size:13px;}
    .lb-score{font-family:'Playfair Display',serif;font-size:20px;color:var(--pink);text-align:right;}
    .lb-sub{font-size:10px;color:var(--muted);}
    .bar-bg{height:4px;background:var(--border);border-radius:2px;margin-top:4px;}
    .bar{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--pink),var(--pink2));transition:width 1s ease;}
    .divider{width:100%;max-width:480px;border:none;border-top:1px solid var(--border);margin:16px 0;}
    #final-results-screen{display:flex;flex-direction:column;align-items:center;padding:36px 20px;min-height:100vh;}
    .final-title{font-family:'Playfair Display',serif;font-size:52px;font-weight:900;color:var(--pink-light);text-align:center;text-shadow:0 0 36px rgba(255,105,180,.35);margin-bottom:4px;}
    .confetti-row{font-size:26px;letter-spacing:4px;margin-bottom:20px;}
    .winner-card{background:linear-gradient(135deg,rgba(255,105,180,.13),rgba(255,20,147,.08));border:2px solid var(--pink);border-radius:18px;padding:20px 36px;text-align:center;margin-bottom:24px;}
    .winner-card .crown{font-size:36px;}
    .winner-name{font-family:'Playfair Display',serif;font-size:30px;color:var(--pink-light);}
    .winner-pts{color:var(--muted);font-size:13px;margin-top:3px;}
    .sub-banner{background:rgba(168,255,120,.07);border:1px solid var(--green);color:var(--green);border-radius:9px;padding:12px 20px;font-size:13px;font-weight:600;text-align:center;margin-top:14px;max-width:420px;width:100%;}
    .pp-item{display:flex;align-items:center;gap:9px;background:var(--card2);border-radius:8px;padding:7px 13px;font-size:12px;margin-bottom:5px;}
    .pp-submitted{color:var(--green);font-size:11px;margin-left:auto;}
    .pp-waiting{color:var(--muted);font-size:11px;margin-left:auto;animation:pdp 2s infinite;}
    .total-pts{font-size:12px;color:var(--pink);font-weight:700;}
    .toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(100px);font-weight:700;padding:10px 22px;border-radius:30px;font-size:13px;transition:transform .4s cubic-bezier(.34,1.56,.64,1);z-index:9999;pointer-events:none;color:#fff;}
    .toast.show{transform:translateX(-50%) translateY(0);}
    #fb-status{position:fixed;top:0;left:0;right:0;padding:8px 20px;font-size:12px;font-weight:700;text-align:center;z-index:9998;display:none;}
    #fb-status.err{background:#c0392b;color:#fff;display:block;}
    #fb-status.ok{background:#27ae60;color:#fff;display:block;}
  </style>
</head>
<body>

<!-- VERSION BANNER -->
<div id="version-banner" onclick="dismissBanner()">
  <div class="vb-dot"></div>
  ‚ú® v2.0 ‚Äî Now tap to rank!
  <span class="vb-x">‚úï</span>
</div>

<div id="fb-status"></div>
<div class="toast" id="toast"></div>

<!-- LANDING -->
<div id="landing" class="page">
  <div class="logo">Order Up!</div>
  <div class="logo-sub">Rank it ¬∑ Match it ¬∑ Win it</div>
  <div class="role-cards">
    <div class="role-card" onclick="goHost()"><div class="ico">üéÆ</div><h2>Host</h2><p>Create a room, pick categories &amp; rank</p></div>
    <div class="role-card" onclick="toggleJoinBox()"><div class="ico">üå∏</div><h2>Player</h2><p>Join a room &amp; guess the host's order</p></div>
  </div>
  <div class="join-box hidden" id="join-box">
    <label>Enter Room Code</label>
    <div class="join-row">
      <input type="text" id="join-code" maxlength="6" placeholder="ABC123"
        style="text-transform:uppercase;letter-spacing:4px;font-family:'Playfair Display',serif;font-size:20px;"
        onkeydown="if(event.key==='Enter')joinAndGo()">
      <button class="btn btn-primary" onclick="joinAndGo()">Join ‚Üí</button>
    </div>
  </div>
</div>

<!-- NAME SCREEN -->
<div id="name-screen" class="page hidden">
  <h2>What's Your Name?</h2>
  <p>This shows on the leaderboard üå∏</p>
  <div class="name-form">
    <input type="text" id="player-name-input" placeholder="Your nickname" maxlength="20" onkeydown="if(event.key==='Enter')confirmName()">
    <button class="btn btn-primary" onclick="confirmName()">Let's Go ‚Üí</button>
  </div>
</div>

<!-- HOST LOBBY -->
<div id="host-lobby" class="page hidden">
  <div class="top-bar"><div class="badge">HOST</div><div id="pcnt" style="color:var(--muted);font-size:13px;">0 players</div></div>
  <div class="room-code-block">
    <label>Room Code ‚Äî Share This!</label>
    <div class="room-code" id="room-code-display">------</div>
  </div>
  <div class="lobby-grid">
    <div class="panel"><h3>üì± Scan to Join</h3><div id="qr-wrap"><div id="qr-inner"></div></div><div class="join-url" id="join-url-text"></div></div>
    <div class="panel"><h3>üå∏ Players Joined</h3><div class="player-list" id="player-list"><div class="no-players">Waiting for players‚Ä¶</div></div></div>
  </div>
  <div style="margin-top:20px;display:flex;gap:10px;flex-wrap:wrap;justify-content:center;">
    <button class="btn btn-primary" onclick="goPickCategory()">Pick Category &amp; Start Round ‚Üí</button>
  </div>
  <div id="rounds-summary" style="margin-top:12px;color:var(--muted);font-size:12px;text-align:center;"></div>
</div>

<!-- HOST CATEGORY PICK -->
<div id="host-pick-screen" class="page hidden">
  <div class="top-bar" style="max-width:920px;">
    <div class="badge">HOST</div>
    <div style="display:flex;gap:10px;align-items:center;">
      <span id="pick-round-label" style="color:var(--muted);font-size:12px;"></span>
      <button class="btn btn-ghost" style="padding:7px 13px;font-size:12px;" onclick="showPage('host-lobby')">‚Üê Lobby</button>
    </div>
  </div>
  <div class="game-head" style="margin-bottom:12px;"><h1>Pick a Category</h1><p>Choose what players will rank this round</p></div>
  <div class="cat-search"><input type="text" id="cat-search-input" placeholder="üîç Search categories‚Ä¶" oninput="filterCategories()"></div>
  <div class="cat-grid" id="cat-grid"></div>
  <button class="btn btn-primary" id="start-round-btn" onclick="startRound()" disabled>Start Round ‚Üí</button>
</div>

<!-- HOST GAME -->
<div id="host-game-screen" class="page hidden">
  <div class="game-wrap">
    <div class="top-bar" style="max-width:480px;"><div class="badge">HOST</div><span id="host-round-badge" class="round-badge"></span></div>
    <div class="game-head"><h1>Your Secret Ranking</h1><p>Tap an item, then tap a slot ‚Äî players must guess this!</p></div>
    <div id="host-cat-label" class="cat-label"></div>
    <div class="locked-bar">üîí Hidden from players until you reveal</div>
    <div class="rank-labels"><span class="rl top">‚≠ê FAVORITE / BEST (#1)</span><span class="rl bot">LEAST FAVORITE ‚ñº</span></div>
    <div class="tap-hint" id="host-tap-hint">üëÜ <b>Tap an item</b> on the right ‚Üí then <b>tap a slot</b> to place it</div>
    <div class="rank-arena">
      <div class="rank-slots" id="host-slots"></div>
      <div class="item-pool" id="host-pool-wrap">
        <div class="pool-label">Tap to pick</div>
        <div id="host-pool"></div>
      </div>
    </div>
    <div style="margin-top:16px;display:flex;gap:10px;flex-wrap:wrap;justify-content:center;">
      <button class="btn btn-ghost" onclick="showPage('host-lobby')">‚Üê Lobby</button>
      <button class="btn btn-primary" id="lock-btn" onclick="lockHostOrder()">üîí Lock In My Order</button>
    </div>
    <div id="reveal-wrap" class="hidden" style="margin-top:12px;width:100%;max-width:480px;">
      <div id="players-progress-host" style="margin-bottom:12px;"></div>
      <div style="text-align:center;"><button class="btn btn-outline" onclick="revealRound()">üå∏ Reveal Round Results!</button></div>
    </div>
    <div id="lock-msg" style="margin-top:9px;color:var(--muted);font-size:12px;text-align:center;"></div>
  </div>
</div>

<!-- WAITING -->
<div id="waiting-screen" class="page hidden">
  <div class="spinner"></div>
  <h2 style="font-family:'Playfair Display',serif;font-size:26px;color:var(--pink-light);margin-bottom:7px;">Waiting for Host</h2>
  <p style="color:var(--muted);margin-bottom:18px;">The host will start the round soon‚Ä¶</p>
  <div style="background:var(--card);border:1px solid var(--border);border-radius:11px;padding:12px 24px;text-align:center;">
    <div style="color:var(--muted);font-size:10px;letter-spacing:2px;text-transform:uppercase;margin-bottom:5px;">Room</div>
    <div id="wait-code" style="font-family:'Playfair Display',serif;font-size:30px;color:var(--pink);letter-spacing:7px;"></div>
  </div>
  <div id="wait-info" style="margin-top:13px;color:var(--muted);font-size:12px;"></div>
  <div id="wait-pts" class="total-pts" style="margin-top:6px;"></div>
</div>

<!-- PLAYER GAME -->
<div id="player-game-screen" class="page hidden">
  <div class="game-wrap">
    <div class="top-bar" style="max-width:480px;">
      <div class="badge player-badge">PLAYER</div>
      <div style="display:flex;gap:10px;align-items:center;">
        <span id="player-round-badge" class="round-badge"></span>
        <span id="player-pts-badge" class="total-pts"></span>
      </div>
    </div>
    <div class="game-head"><h1>Guess the Host's Order</h1><p>Tap an item, then tap a slot to place it!</p></div>
    <div id="player-cat-label" class="cat-label"></div>
    <div class="rank-labels"><span class="rl top">‚≠ê HOST'S FAVORITE (#1)</span><span class="rl bot">LEAST FAVORITE ‚ñº</span></div>
    <div class="tap-hint" id="player-tap-hint">üëÜ <b>Tap an item</b> on the right ‚Üí then <b>tap a slot</b> to place it</div>
    <div class="rank-arena">
      <div class="rank-slots" id="player-slots"></div>
      <div class="item-pool" id="player-pool-wrap">
        <div class="pool-label">Tap to pick</div>
        <div id="player-pool"></div>
      </div>
    </div>
    <button class="btn btn-primary" id="submit-btn" style="margin-top:15px;" onclick="submitOrder()">Submit My Guess ‚úì</button>
    <div id="sub-banner" class="hidden"><div class="sub-banner">‚úÖ Submitted! Waiting for host to reveal‚Ä¶</div></div>
  </div>
</div>

<!-- ROUND RESULTS -->
<div id="round-results-screen" class="page hidden">
  <div class="rr-title" id="rr-title">Round Results</div>
  <p style="color:var(--muted);margin-bottom:4px;" id="rr-cat-label"></p>
  <div id="player-own-results" class="hidden" style="width:100%;max-width:420px;">
    <div class="your-score-box"><div class="score-num" id="rr-your-score">0/5</div><div class="score-label">correct placements this round</div></div>
    <p class="result-section-title">Your Answers vs Host's Order</p>
    <ul class="slist" id="player-result-list"></ul>
  </div>
  <div style="width:100%;max-width:420px;">
    <p class="result-section-title" style="margin-top:14px;">üèÜ Host's Actual Ranking</p>
    <div class="rank-labels"><span class="rl top">‚≠ê FAVORITE</span><span class="rl bot">LEAST FAVORITE ‚ñº</span></div>
    <ul class="slist" id="rr-host-list"></ul>
  </div>
  <hr class="divider">
  <div class="lb"><h3>üìä Round Leaderboard</h3><div id="rr-lb-list"></div></div>
  <div style="margin-top:20px;display:flex;gap:10px;flex-wrap:wrap;justify-content:center;" id="rr-buttons"></div>
</div>

<!-- FINAL RESULTS -->
<div id="final-results-screen" class="page hidden">
  <div class="confetti-row">üå∏‚ú®üíñ‚ú®üå∏</div>
  <div class="final-title">Game Over!</div>
  <p style="color:var(--muted);margin-bottom:20px;">Final Scores ‚Äî All Rounds</p>
  <div class="winner-card"><div class="crown">üëë</div><div class="winner-name" id="winner-name">-</div><div class="winner-pts" id="winner-pts">-</div></div>
  <div class="lb" style="max-width:480px;"><h3>üèÜ Final Leaderboard</h3><div id="final-lb-list"></div></div>
  <div style="margin-top:24px;"><button class="btn btn-primary" onclick="location.reload()">Play Again üå∏</button></div>
</div>

<script>
// ‚îÄ‚îÄ VERSION BANNER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function dismissBanner(){
  var b=document.getElementById('version-banner');
  b.classList.add('gone');
  setTimeout(function(){b.style.display='none';},400);
}
setTimeout(dismissBanner, 7000);

// ‚îÄ‚îÄ FIREBASE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
firebase.initializeApp({
  apiKey:"AIzaSyCoRWphqnWGI3oO2WkNXL7oSLCe7Py_09w",
  authDomain:"orderup-c928b.firebaseapp.com",
  databaseURL:"https://orderup-c928b-default-rtdb.firebaseio.com",
  projectId:"orderup-c928b",
  storageBucket:"orderup-c928b.firebasestorage.app",
  messagingSenderId:"436213481520",
  appId:"1:436213481520:web:91e6c3e57872f90ff32df5"
});
var db=firebase.database();
db.ref('.info/connected').on('value',function(s){
  var b=document.getElementById('fb-status');
  if(s.val()){b.textContent='‚úÖ Connected!';b.className='ok';setTimeout(function(){b.style.display='none';},2200);}
  else{b.textContent='‚ö†Ô∏è Not connected ‚Äî fix Firebase rules at console.firebase.google.com';b.className='err';}
});

// ‚îÄ‚îÄ CATEGORIES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
var CATEGORIES=[
  {type:'Movies',name:'Hunger Games Films',items:['The Hunger Games','Catching Fire','Mockingjay Part 1','Mockingjay Part 2','Ballad of Songbirds & Snakes']},
  {type:'Movies',name:'Harry Potter Films',items:["Sorcerer's Stone","Chamber of Secrets","Prisoner of Azkaban","Goblet of Fire","Order of the Phoenix"]},
  {type:'Movies',name:'Scream Films',items:['Scream','Scream 2','Scream 3','Scream 4','Scream 5']},
  {type:'Movies',name:'Halloween Films',items:['Halloween (1978)','Halloween II','Halloween H20','Halloween (2018)','Halloween Ends']},
  {type:'Movies',name:'Friday the 13th Films',items:['Friday the 13th','Part 2','Part 3','The Final Chapter','Jason Lives']},
  {type:'Movies',name:'Girl Movies',items:['Mean Girls','Clueless','Heathers','Easy A','Legally Blonde']},
  {type:'Movies',name:'Twilight Films',items:['Twilight','New Moon','Eclipse','Breaking Dawn Part 1','Breaking Dawn Part 2']},
  {type:'Movies',name:'YA Dystopia Films',items:['The Maze Runner','The Scorch Trials','The Death Cure','Divergent','Insurgent']},
  {type:'Movies',name:'Disney Animated (Modern)',items:['Frozen','Frozen II','Tangled','Moana','Raya and the Last Dragon']},
  {type:'Movies',name:'Disney Animated (Classic)',items:['The Little Mermaid','Beauty and the Beast','Aladdin','Cinderella','Snow White']},
  {type:'Movies',name:'Pixar Films',items:['The Incredibles','Up','Inside Out','Coco','Soul']},
  {type:'Movies',name:'Pixar Sequels',items:['Toy Story 2','Toy Story 3','Finding Dory','Incredibles 2','Inside Out 2']},
  {type:'Movies',name:'Marvel Avengers Films',items:['The Avengers','Age of Ultron','Infinity War','Endgame','Civil War']},
  {type:'Movies',name:'Marvel Phase 1 Films',items:['Iron Man','The Incredible Hulk','Iron Man 2','Thor','Captain America: The First Avenger']},
  {type:'Movies',name:'Spider-Man Films',items:['Spider-Man (2002)','Into the Spider-Verse','Homecoming','No Way Home','Across the Spider-Verse']},
  {type:'Movies',name:'DC Films',items:['The Dark Knight','Wonder Woman','Aquaman','Shazam!','The Suicide Squad']},
  {type:'Movies',name:'Batman Films',items:['Batman (1989)','Batman Returns','The Dark Knight','Batman v Superman','The Batman (2022)']},
  {type:'Movies',name:'Rom-Coms',items:['10 Things I Hate About You','Bridget Jones Diary','How to Lose a Guy in 10 Days','Crazy Rich Asians',"To All the Boys I've Loved Before"]},
  {type:'Movies',name:'90s Animated Films',items:['The Lion King','Mulan','Hercules','Tarzan','The Hunchback of Notre Dame']},
  {type:'Movies',name:'2000s Teen Movies',items:['Bring It On','13 Going on 30','A Cinderella Story','Freaky Friday','The Princess Diaries']},
  {type:'Movies',name:'Animated Sequels',items:['Shrek 2','Kung Fu Panda 2','How to Train Your Dragon 2','Despicable Me 2','Puss in Boots: The Last Wish']},
  {type:'Movies',name:'Horror Franchises',items:['A Nightmare on Elm Street','Halloween','Friday the 13th','Scream','The Texas Chain Saw Massacre']},
  {type:'Movies',name:'Psychological Thrillers',items:['Get Out','Hereditary','Midsommar','The Witch','Us']},
  {type:'Movies',name:'Fantasy Adventure Films',items:['The Princess Bride','Labyrinth','The NeverEnding Story','Willow','Stardust']},
  {type:'Movies',name:"Animated Villains' Origin Movies",items:['Maleficent','Cruella','Joker','Venom','Megamind']},
  {type:'TV',name:'Crime Procedurals',items:['Criminal Minds','Bones','NCIS','Law & Order SVU','Mindhunter']},
  {type:'TV',name:'Supernatural Teen Dramas',items:['Supernatural','The Vampire Diaries','Teen Wolf','The Originals','Buffy the Vampire Slayer']},
  {type:'TV',name:'British Dramas',items:['Sherlock','Doctor Who','Black Mirror','Broadchurch','Luther']},
  {type:'TV',name:'Cult Sci-Fi & Mystery',items:['Stranger Things','The Umbrella Academy','Dark','Yellowjackets','Lost']},
  {type:'TV',name:'Teen Dramas',items:['Glee','Riverdale','Pretty Little Liars','Gossip Girl','The OC']},
  {type:'TV',name:'Reality Competition Shows',items:["RuPaul's Drag Race",'Survivor','The Amazing Race','Big Brother','The Voice']},
  {type:'TV',name:'Animated Adult Shows',items:["Bob's Burgers",'Archer','BoJack Horseman','Futurama','Rick and Morty']},
  {type:'TV',name:'Sitcoms',items:['The Office','Parks and Recreation','Brooklyn Nine-Nine','New Girl',"Schitt's Creek"]},
  {type:'TV',name:'Fantasy & Sci-Fi Dramas',items:['Game of Thrones','The Witcher','Wheel of Time','Shadow and Bone','House of the Dragon']},
  {type:'TV',name:'Netflix Originals',items:['Squid Game','Bridgerton','Outer Banks','Emily in Paris','Wednesday']},
  {type:'TV',name:'Animated Kids Shows (2000s)',items:['Kim Possible','The Fairly OddParents','Danny Phantom','My Life as a Teenage Robot','Lizzie McGuire']},
  {type:'TV',name:'Cartoon Network Classics',items:['The Powerpuff Girls',"Dexter's Laboratory",'Ed Edd n Eddy','Courage the Cowardly Dog','Johnny Bravo']},
  {type:'TV',name:'Nickelodeon Classics',items:['SpongeBob SquarePants','Rugrats','Hey Arnold!','Invader Zim','The Fairly OddParents']},
  {type:'TV',name:'Anime Series',items:['Attack on Titan','Demon Slayer','Fullmetal Alchemist: Brotherhood','My Hero Academia','Death Note']},
  {type:'TV',name:'Shojo Anime',items:['Sailor Moon','Fruits Basket','Ouran High School Host Club','Cardcaptor Sakura','Kimi ni Todoke']},
  {type:'TV',name:'Isekai Anime',items:['Sword Art Online','Re:Zero','That Time I Got Reincarnated as a Slime','No Game No Life','Overlord']},
  {type:'TV',name:'Medical Dramas',items:["Grey's Anatomy",'House MD','ER','Scrubs','The Good Doctor']},
  {type:'TV',name:'True Crime Shows',items:['Making a Murderer','The Jinx','Tiger King','Conversations with a Killer','The Staircase']},
  {type:'TV',name:'Late Night Hosts',items:['Jimmy Fallon','Stephen Colbert','Jimmy Kimmel',"Conan O'Brien",'Seth Meyers']},
  {type:'TV',name:'Competition Cooking Shows',items:['Top Chef','MasterChef','The Great British Bake Off','Chopped',"Hell's Kitchen"]},
  {type:'Games',name:'Cozy & Sandbox Games',items:['Minecraft','Stardew Valley','Terraria','Animal Crossing','The Sims 4']},
  {type:'Games',name:'Multiplayer Party Games',items:['Among Us','Fall Guys','Fortnite','Roblox','Valorant']},
  {type:'Games',name:'Indie Story Games',items:['Undertale','Deltarune','Omori','Celeste','Hollow Knight']},
  {type:'Games',name:'Horror Games',items:["Five Nights at Freddy's",'Poppy Playtime','Bendy and the Ink Machine','Little Nightmares','Hello Neighbor']},
  {type:'Games',name:'Pokemon Games',items:['Pokemon Red','Pokemon Gold','Pokemon Emerald','Pokemon Platinum','Pokemon Sword']},
  {type:'Games',name:'Mario Games',items:['Mario Kart 8','Super Smash Bros Ultimate','Mario Odyssey','Mario Party','Mario Kart Wii']},
  {type:'Games',name:'Legend of Zelda Games',items:['Ocarina of Time','Breath of the Wild',"Majora's Mask",'Tears of the Kingdom','Wind Waker']},
  {type:'Games',name:'RPG Games',items:['Skyrim','Witcher 3',"Baldur's Gate 3",'Final Fantasy VII','Elden Ring']},
  {type:'Games',name:'Platformer Games',items:['Super Mario Bros','Crash Bandicoot','Banjo-Kazooie','Spyro the Dragon','Rayman']},
  {type:'Games',name:'Survival Horror Games',items:['Resident Evil 2','Silent Hill 2','Outlast','Amnesia: The Dark Descent','Alien: Isolation']},
  {type:'Games',name:'Visual Novels / Story Games',items:['Doki Doki Literature Club','Life is Strange','Disco Elysium','80 Days','Hades']},
  {type:'Games',name:'Nintendo Switch Games',items:['Breath of the Wild','Mario Kart 8 Deluxe','Splatoon 3','Pokemon Scarlet/Violet','Kirby and the Forgotten Land']},
  {type:'Games',name:'PS4/PS5 Exclusives',items:['The Last of Us','God of War','Ghost of Tsushima','Horizon Zero Dawn','Spider-Man (PS4)']},
  {type:'Games',name:'Rhythm Games',items:['Just Dance','Guitar Hero','Beat Saber',"Friday Night Funkin'",'Thumper']},
  {type:'Games',name:'Battle Royale Games',items:['Fortnite','Apex Legends','PUBG','Warzone','Fall Guys']},
  {type:'Games',name:'Life Sim Games',items:['The Sims 4','Animal Crossing: New Horizons','Stardew Valley','Story of Seasons','Coral Island']},
  {type:'Games',name:'Pokemon Generations',items:['Gen 1 (Kanto)','Gen 2 (Johto)','Gen 3 (Hoenn)','Gen 4 (Sinnoh)','Gen 5 (Unova)']},
  {type:'Games',name:'Super Smash Bros Fighters',items:['Kirby','Pikachu','Link','Samus','Marth']},
  {type:'Characters',name:'Hunger Games Characters',items:['Katniss Everdeen','Peeta Mellark','Gale Hawthorne','Lucy Gray Baird','Coriolanus Snow']},
  {type:'Characters',name:'Harry Potter Characters',items:['Harry Potter','Hermione Granger','Ron Weasley','Draco Malfoy','Luna Lovegood']},
  {type:'Characters',name:'Supernatural Characters',items:['Dean Winchester','Sam Winchester','Castiel','Crowley','Bobby Singer']},
  {type:'Characters',name:'Vampire Diaries Characters',items:['Damon Salvatore','Stefan Salvatore','Elena Gilbert','Klaus Mikaelson','Caroline Forbes']},
  {type:'Characters',name:'Teen Wolf Characters',items:['Stiles Stilinski','Scott McCall','Lydia Martin','Derek Hale','Allison Argent']},
  {type:'Characters',name:'Wednesday Characters',items:['Wednesday Addams','Morticia Addams','Gomez Addams','Enid Sinclair','Uncle Fester']},
  {type:'Characters',name:'Superheroes',items:['Batman','Spider-Man','Iron Man','Captain America','Thor']},
  {type:'Characters',name:'Villains',items:['The Joker','Harley Quinn','Poison Ivy','Catwoman','Riddler']},
  {type:'Characters',name:'Frozen Characters',items:['Elsa','Anna','Olaf','Kristoff','Hans']},
  {type:'Characters',name:'Tangled Characters',items:['Rapunzel','Flynn Rider','Mother Gothel','Maximus','Pascal']},
  {type:'Characters',name:'Avatar: The Last Airbender',items:['Aang','Katara','Sokka','Zuko','Toph']},
  {type:'Characters',name:'Steven Universe Characters',items:['Steven Universe','Garnet','Amethyst','Pearl','Peridot']},
  {type:'Characters',name:'Winx Club Characters',items:['Bloom','Stella','Flora','Musa','Tecna']},
  {type:'Characters',name:'Monster High Characters',items:['Draculaura','Frankie Stein','Clawdeen Wolf','Lagoona Blue','Cleo de Nile']},
  {type:'Characters',name:'Slasher Icons',items:['Ghostface','Michael Myers','Jason Voorhees','Freddy Krueger','Leatherface']},
  {type:'Characters',name:'Horror Villains',items:['Chucky','Annabelle','Pennywise','The Nun','Sam from Trick r Treat']},
  {type:'Characters',name:'Marvel Avengers',items:['Iron Man','Captain America','Thor','Black Widow','Hulk']},
  {type:'Characters',name:'Marvel X-Men',items:['Wolverine','Storm','Cyclops','Jean Grey','Rogue']},
  {type:'Characters',name:'DC Justice League',items:['Batman','Superman','Wonder Woman','The Flash','Aquaman']},
  {type:'Characters',name:'DC Villains',items:['The Joker','Lex Luthor','Harley Quinn','Brainiac','Darkseid']},
  {type:'Characters',name:'Stranger Things Characters',items:['Eleven','Mike Wheeler','Dustin Henderson','Max Mayfield','Steve Harrington']},
  {type:'Characters',name:'Bridgerton Characters',items:['Daphne Bridgerton','Simon Basset','Anthony Bridgerton','Kate Sharma','Benedict Bridgerton']},
  {type:'Characters',name:'Encanto Characters',items:['Mirabel Madrigal','Luisa Madrigal','Isabela Madrigal','Camilo Madrigal','Bruno Madrigal']},
  {type:'Characters',name:'Moana Characters',items:['Moana','Maui','Tamatoa','Gramma Tala','Te Fiti']},
  {type:'Characters',name:'MHA Heroes',items:['Deku','Bakugo','Todoroki','Uraraka','All Might']},
  {type:'Characters',name:'MHA Villains',items:['Shigaraki','Dabi','Toga','All For One','Twice']},
  {type:'Characters',name:'Demon Slayer Characters',items:['Tanjiro','Nezuko','Zenitsu','Inosuke','Rengoku']},
  {type:'Characters',name:'Attack on Titan Characters',items:['Eren Yeager','Mikasa Ackerman','Armin Arlert','Levi Ackerman','Hange Zoe']},
  {type:'Characters',name:'Sailor Moon Senshi',items:['Sailor Moon','Sailor Mercury','Sailor Mars','Sailor Jupiter','Sailor Venus']},
  {type:'Characters',name:'MLP Mane 6',items:['Twilight Sparkle','Rainbow Dash','Fluttershy','Rarity','Applejack']},
  {type:'Characters',name:'MLP Supporting Cast',items:['Princess Celestia','Princess Luna','Spike','Discord','Starlight Glimmer']},
  {type:'Characters',name:'MLP Villains',items:['Discord','Queen Chrysalis','Nightmare Moon','King Sombra','Tirek']},
  {type:'Characters',name:'Pixar Characters',items:['Woody','Buzz Lightyear','WALL-E','Nemo','Merida']},
  {type:'Characters',name:'Disney Princesses',items:['Cinderella','Ariel','Belle','Jasmine','Mulan']},
  {type:'Characters',name:'Disney Villains',items:['Maleficent','Ursula','Gaston','Jafar','Hades']},
  {type:'Music',name:'Taylor Swift Albums',items:['Fearless','1989','Reputation','Folklore','Midnights']},
  {type:'Music',name:'Taylor Swift Eras',items:['Country Era','Pop Era','Reputation Era','Folklorian Era','Eras Tour Era']},
  {type:'Music',name:'Beyonc√© Albums',items:['Lemonade','Dangerously in Love','4','Beyonc√© (Self-Titled)','Renaissance']},
  {type:'Music',name:'Olivia Rodrigo Songs',items:['drivers license','good 4 u','brutal','happier','vampire']},
  {type:'Music',name:'Billie Eilish Albums',items:['When We All Fall Asleep...','Happier Than Ever','Hit Me Hard and Soft',"Don't Smile at Me EP",'Guitar Songs EP']},
  {type:'Music',name:'Ariana Grande Albums',items:['Thank U Next','Sweetener','Positions','Yours Truly','My Everything']},
  {type:'Music',name:'Doja Cat Albums',items:['Hot Pink','Planet Her','Scarlet','Amala','Candy']},
  {type:'Music',name:'SZA Albums',items:['Ctrl','SOS','Good Days EP','Z EP','Hit Different']},
  {type:'Music',name:'Pop Divas',items:['Beyonc√©','Taylor Swift','Ariana Grande','Rihanna','Lady Gaga']},
  {type:'Music',name:'Pop Punk Bands',items:['Paramore','My Chemical Romance','Fall Out Boy','Panic! at the Disco','Green Day']},
  {type:'Music',name:'K-Pop Groups',items:['BTS','BLACKPINK','TWICE','Stray Kids','aespa']},
  {type:'Music',name:'K-Pop Girl Groups',items:['BLACKPINK','TWICE','aespa','IVE','NewJeans']},
  {type:'Music',name:'K-Pop Boy Groups',items:['BTS','Stray Kids','EXO','NCT 127','ATEEZ']},
  {type:'Music',name:'90s Pop Stars',items:['Britney Spears','Christina Aguilera','Backstreet Boys','NSYNC','Spice Girls']},
  {type:'Music',name:'2000s Bops Era',items:['Fergalicious','Hollaback Girl','Since U Been Gone','My Humps','Beautiful']},
  {type:'Music',name:'Iconic Music Videos',items:['Thriller','Single Ladies','Bad Romance','Wrecking Ball','This Is America']},
  {type:'Music',name:'Alternative Artists',items:['Lorde','Lana Del Rey','Florence + The Machine','Halsey','Mitski']},
  {type:'Music',name:'Lana Del Rey Albums',items:['Born to Die','Ultraviolence','Lust for Life','Norman Fucking Rockwell',"Did You Know There's a Tunnel Under Ocean Blvd"]},
  {type:'Music',name:'Harry Styles Albums',items:['Harry Styles','Fine Line',"Harry's House",'One Direction Era','As It Was Single']},
  {type:'Music',name:'Sabrina Carpenter Songs',items:['Espresso','Please Please Please','Feather','Nonsense','Skin']},
  {type:'Music',name:'Chappell Roan Songs',items:['Good Luck Babe!','Red Wine Supernova','HOT TO GO!','Casual','Pink Pony Club']},
  {type:'Music',name:'Rap/Hip-Hop Artists',items:['Kendrick Lamar','Drake','Nicki Minaj','Cardi B','Travis Scott']},
  {type:'Music',name:'Iconic Albums of All Time',items:['Thriller','Purple Rain','Rumours','Born to Run','Abbey Road']},
  {type:'Music',name:'Musical Genres',items:['Pop','Hip-Hop','R&B','Rock','Country']},
  {type:'Music',name:'Iconic Girl Bands',items:['Spice Girls',"Destiny's Child",'Little Mix','Fifth Harmony','TLC']},
  {type:'Music',name:'Coachella Headliners (2019-2024)',items:['Beyonc√©','Billie Eilish','Bad Bunny','Frank Ocean','Lana Del Rey']},
  {type:'Books',name:'Harry Potter Books',items:["Sorcerer's Stone","Chamber of Secrets","Prisoner of Azkaban","Goblet of Fire","Order of the Phoenix"]},
  {type:'Books',name:'Hunger Games Books',items:['The Hunger Games','Catching Fire','Mockingjay','Ballad of Songbirds & Snakes','The Unofficial Guide']},
  {type:'Books',name:'Twilight Saga Books',items:['Twilight','New Moon','Eclipse','Breaking Dawn','Midnight Sun']},
  {type:'Books',name:'Percy Jackson Books',items:['The Lightning Thief','Sea of Monsters',"Titan's Curse",'Battle of the Labyrinth','The Last Olympian']},
  {type:'Books',name:'A Court of Thorns & Roses',items:['A Court of Thorns and Roses','A Court of Mist and Fury','A Court of Wings and Ruin','A Court of Frost and Starlight','A Court of Silver Flames']},
  {type:'Books',name:'Six of Crows Duology',items:['Six of Crows','Crooked Kingdom','Shadow and Bone','Siege and Storm','Ruin and Rising']},
  {type:'Books',name:'Divergent Series',items:['Divergent','Insurgent','Allegiant','Four','The Transfer']},
  {type:'Books',name:'Maze Runner Series',items:['The Maze Runner','The Scorch Trials','The Death Cure','The Kill Order','The Fever Code']},
  {type:'Books',name:'Sarah J. Maas Series',items:['ACOTAR','Throne of Glass','Crescent City','A Court of Mist and Fury','A Court of Silver Flames']},
  {type:'Books',name:'Colleen Hoover Books',items:['Verity','It Ends with Us','Ugly Love','Confess','November 9']},
  {type:'Books',name:'Classic YA Books',items:['The Outsiders','The Perks of Being a Wallflower','Looking for Alaska','The Fault in Our Stars','Thirteen Reasons Why']},
  {type:'Books',name:'Fantasy Series',items:['Lord of the Rings','Game of Thrones','Wheel of Time','Name of the Wind','Stormlight Archive']},
  {type:'Books',name:'Warrior Cats Arcs',items:['The Prophecies Begin','The New Prophecy','Power of Three','Omen of the Stars','A Vision of Shadows']},
  {type:'Books',name:'Graphic Novel Series',items:['Saga','Maus','Watchmen','Persepolis','Fun Home']},
  {type:'Books',name:'Manga Series',items:['Attack on Titan','My Hero Academia','Demon Slayer','Naruto','One Piece']},
  {type:'MLP',name:'MLP Seasons',items:['Season 1','Season 2','Season 3','Season 4','Season 5']},
  {type:'MLP',name:'MLP Episodes (S1)',items:['Friendship is Magic','Applebuck Season','Bridle Gossip','Suited for Success','The Best Night Ever']},
  {type:'MLP',name:'MLP Movies & Specials',items:['Equestria Girls','Rainbow Rocks','Friendship Games','Legend of Everfree','The MLP Movie (2017)']},
  {type:'MLP',name:'MLP Cutie Mark Crusaders',items:['Apple Bloom','Sweetie Belle','Scootaloo','Babs Seed','Diamond Tiara (reformed)']},
  {type:'MLP',name:'MLP Alicorn Princesses',items:['Princess Celestia','Princess Luna','Princess Cadance','Princess Twilight Sparkle','Princess Flurry Heart']},
  {type:'MLP',name:'MLP Ships',items:['Twilight x Flash','Rarity x Spike','Rainbow x Applejack','Fluttershy x Discord','Pinkie x Cheese Sandwich']},
  {type:'MLP',name:'MLP Songs',items:['My Little Pony Theme','Winter Wrap Up','This Day Aria',"You'll Play Your Part",'Open Up Your Eyes']},
  {type:'MLP',name:'MLP Background Ponies',items:['Derpy Hooves','Doctor Whooves','Lyra Heartstrings','Bon Bon','Octavia Melody']},
  {type:'MLP',name:'MLP Student Six',items:['Sandbar','Gallus','Silverstream','Smolder','Ocellus']},
  {type:'MLP',name:'MLP Elements of Harmony',items:['Magic (Twilight)','Loyalty (Rainbow)','Kindness (Fluttershy)','Generosity (Rarity)','Laughter (Pinkie)']},
  {type:'Food',name:'Fast Food Chains',items:["McDonald's","Chick-fil-A","Taco Bell","Wendy's","Burger King"]},
  {type:'Food',name:'Pizza Toppings',items:['Pepperoni','Mushrooms','Extra Cheese','Sausage','Black Olives']},
  {type:'Food',name:'Ice Cream Flavors',items:['Chocolate','Vanilla','Strawberry','Cookies & Cream','Mint Chip']},
  {type:'Food',name:'Halloween Candies',items:["Reese's","Kit Kat","Twix","Snickers","Candy Corn"]},
  {type:'Food',name:'Starbucks Drinks',items:['Pumpkin Spice Latte','Iced Brown Sugar Oat Latte','Caramel Macchiato','Pink Drink','Matcha Latte']},
  {type:'Food',name:'Starbucks Secret Menu',items:['Butterbeer Latte','Ombre Pink Drink','Skittles Refresher','TikTok Lemonade','Cotton Candy Frappuccino']},
  {type:'Food',name:'Boba / Bubble Tea Flavors',items:['Taro','Matcha','Brown Sugar Milk Tea','Mango','Strawberry']},
  {type:'Food',name:'Comfort Foods',items:['Mac and Cheese','Grilled Cheese','Ramen','Chicken Soup','Mashed Potatoes']},
  {type:'Food',name:'Desserts',items:['Chocolate Cake','Cheesecake','Brownies','Cinnamon Rolls','Tiramisu']},
  {type:'Food',name:'Breakfast Foods',items:['Pancakes','Waffles','Avocado Toast','Eggs Benedict','A√ßa√≠ Bowl']},
  {type:'Food',name:'Chip Flavors',items:['Original','Sour Cream & Onion','BBQ','Salt & Vinegar',"Flamin' Hot"]},
  {type:'Food',name:'Soda Brands',items:['Coca-Cola','Pepsi','Dr. Pepper','Sprite','Mountain Dew']},
  {type:'Food',name:'Cookie Types',items:['Chocolate Chip','Sugar Cookie','Snickerdoodle','Peanut Butter','Oatmeal Raisin']},
  {type:'Food',name:'Brunch Dishes',items:['French Toast','Eggs Benedict','Avocado Toast','Mimosa','Smashed Potatoes']},
  {type:'Food',name:'Candy Bars',items:["Reese's",'Snickers','Kit Kat','Twix','Milky Way']},
  {type:'Food',name:'Coffee Orders',items:['Iced Latte','Cappuccino','Cold Brew','Flat White','Americano']},
  {type:'Food',name:'International Cuisines',items:['Italian','Mexican','Japanese','Indian','Thai']},
  {type:'Food',name:'Pasta Dishes',items:['Spaghetti Bolognese','Carbonara','Alfredo','Pesto Pasta','Lasagna']},
  {type:'Food',name:'Fruit Tier List',items:['Strawberry','Mango','Watermelon','Peach','Pineapple']},
  {type:'Food',name:'Thanksgiving Dishes',items:['Turkey','Stuffing','Mashed Potatoes','Cranberry Sauce','Pumpkin Pie']},
  {type:'Other',name:'Streaming Services',items:['Netflix','Hulu','Disney+','Max','Prime Video']},
  {type:'Other',name:'Music Platforms',items:['Spotify','Apple Music','YouTube Music','SoundCloud','Physical CDs']},
  {type:'Other',name:'Social Media',items:['TikTok','Instagram','Twitter/X','Tumblr','YouTube']},
  {type:'Other',name:'Childhood TV Channels',items:['Early 2000s Disney Channel','Nickelodeon','Cartoon Network','PBS Kids','Fox Kids']},
  {type:'Other',name:'Romance Tropes',items:['Enemies to Lovers','Friends to Lovers','Fake Dating','Slow Burn','Second Chance']},
  {type:'Other',name:'Decades',items:['1980s','1990s','2000s','2010s','2020s']},
  {type:'Other',name:'Aesthetic Vibes',items:['Cottagecore','Dark Academia','Y2K','Barbiecore','Goblincore']},
  {type:'Other',name:'Halloween Costumes',items:['Witch','Vampire','Ghost','Zombie','Fairy']},
  {type:'Other',name:'Holiday Movies',items:['Home Alone','Elf','A Christmas Story','The Holiday','How the Grinch Stole Christmas']},
  {type:'Other',name:'School Subjects',items:['English','Math','Art','History','Science']},
  {type:'Other',name:'Love Languages',items:['Words of Affirmation','Quality Time','Physical Touch','Acts of Service','Gift Giving']},
  {type:'Other',name:'Myers-Briggs Types (most popular)',items:['INFP','INFJ','ENFP','INTJ','ISFJ']},
  {type:'Other',name:'Hogwarts Houses',items:['Gryffindor','Hufflepuff','Ravenclaw','Slytherin','Sorting Hat']},
  {type:'Other',name:'Greek Gods',items:['Zeus','Athena','Apollo','Artemis','Poseidon']},
  {type:'Other',name:'Zodiac Signs',items:['Aries','Scorpio','Leo','Gemini','Pisces']},
  {type:'Other',name:'Fashion Eras',items:['70s Boho','80s Power Shoulders','90s Grunge','2000s Bratz Doll','2010s Hipster']},
  {type:'Other',name:'Types of Bags',items:['Tote Bag','Crossbody','Backpack','Clutch','Mini Bag']},
  {type:'Other',name:'Disney Parks Rides',items:['Haunted Mansion','Space Mountain','Pirates of the Caribbean','Splash Mountain','Matterhorn']},
  {type:'Other',name:'Types of Pets',items:['Dog','Cat','Rabbit','Bird','Fish']},
  {type:'Other',name:'Vacation Types',items:['Beach','City Break','Mountain Hiking','Road Trip','All-Inclusive Resort']},
  {type:'Other',name:'Superpowers',items:['Flight','Invisibility','Time Travel','Telepathy','Super Strength']},
  {type:'Other',name:'Fictional Worlds to Live In',items:['Hogwarts','Middle-Earth','Narnia','Panem','Equestria']},
];

var TYPE_EMOJI={Movies:'üé¨',TV:'üì∫',Games:'üéÆ',Characters:'‚ú®',Music:'üéµ',Books:'üìö',Food:'üçï',MLP:'ü¶Ñ',Other:'üåü',Bonus:'üå∏'};
var RANK_COLORS=['#ff1493','#ff4da6','#ff69b4','#e0709a','#b06080'];
var AVATARS=['ü¶ä','üêØ','üêª','ü¶Å','üê∏','ü¶Ñ','üê∫','ü¶ù','üêß','ü¶ã','üå∏','ü¶©'];
var TROPHIES=['ü•á','ü•à','ü•â'];
var BASE_URL='https://acostenbader4-del.github.io/orderupalie/';

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
var roomId=null,isHost=false,playerId='p_'+Math.random().toString(36).slice(2,9);
var playerName='',playerSubmitted=false,playerTotalScore=0;
var currentRound=0,currentCategoryIndex=null,usedCatIndexes=[],selectedCatIndex=null;

// tap-to-rank state: { slots:[...], selected:null|string, items:[...] }
var boards={host:{slots:[],selected:null,items:[]},player:{slots:[],selected:null,items:[]}};

function rc(i){return RANK_COLORS[Math.min(i,RANK_COLORS.length-1)];}

// ‚îÄ‚îÄ TAP-TO-RANK ENGINE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initBoard(key,items){
  boards[key]={slots:new Array(items.length).fill(null),selected:null,items:items.slice()};
  renderBoard(key);
}

function renderBoard(key){
  var b=boards[key];
  var slotsEl=document.getElementById(key+'-slots');
  var poolEl=document.getElementById(key+'-pool');
  var poolWrap=document.getElementById(key+'-pool-wrap');
  var n=b.items.length;
  var placed=b.slots.filter(Boolean);
  var inPool=b.items.filter(function(x){return placed.indexOf(x)===-1;});

  // slots
  slotsEl.innerHTML='';
  for(var i=0;i<n;i++){
    (function(idx){
      var val=b.slots[idx];
      var div=document.createElement('div');
      var c=rc(idx);
      div.className='rank-slot'+(val?' filled':'')+(b.selected!==null?' slot-ready':'');
      div.innerHTML='<span class="slot-num" style="color:'+c+'">'+(idx+1)+'</span>'
        +(val
          ?'<span class="slot-name">'+val+'</span><span class="slot-remove">‚úï</span>'
          :'<span class="slot-empty">'+(b.selected?'‚Üê place here':'empty')+'</span>');
      if(val){
        div.querySelector('.slot-remove').addEventListener('click',function(e){
          e.stopPropagation();
          b.slots[idx]=null;
          renderBoard(key);
        });
      }
      div.addEventListener('click',function(){
        if(b.selected!==null){
          // place selected item here; if occupied, kick old item back to pool automatically
          b.slots[idx]=b.selected;
          b.selected=null;
          renderBoard(key);
        }
      });
      slotsEl.appendChild(div);
    })(i);
  }

  // pool
  poolEl.innerHTML='';
  inPool.forEach(function(item){
    var div=document.createElement('div');
    div.className='pool-item'+(b.selected===item?' sel':'');
    div.textContent=item;
    div.addEventListener('click',function(){
      b.selected=(b.selected===item)?null:item;
      renderBoard(key);
    });
    poolEl.appendChild(div);
  });

  // hide pool column when empty
  poolWrap.style.display=inPool.length===0?'none':'';
}

function getBoardOrder(key){return boards[key].slots.slice();}
function isBoardFull(key){return boards[key].slots.every(function(s){return s!==null;});}

// ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showPage(id){
  document.querySelectorAll('.page').forEach(function(p){p.classList.add('hidden');});
  document.getElementById(id).classList.remove('hidden');
  window.scrollTo(0,0);
}
function showToast(msg,isErr){
  var t=document.getElementById('toast');
  t.textContent=msg;t.style.background=isErr?'#c0392b':'#ff69b4';
  t.classList.add('show');setTimeout(function(){t.classList.remove('show');},2800);
}
function buildStaticList(ulId,items){
  var ul=document.getElementById(ulId);ul.innerHTML='';
  items.forEach(function(item,i){
    var li=document.createElement('li');var c=rc(i);
    li.innerHTML='<div class="stripe" style="background:'+c+'"></div>'
      +'<span class="rnum" style="color:'+c+'">'+(i+1)+'</span>'
      +'<span class="iname">'+item+'</span>';
    ul.appendChild(li);
  });
}
function buildResultList(ulId,playerOrder,hostOrder){
  var ul=document.getElementById(ulId);ul.innerHTML='';
  playerOrder.forEach(function(item,i){
    var li=document.createElement('li');
    var correct=item===hostOrder[i];
    li.classList.add(correct?'correct':'wrong');
    var c=rc(i),hostPos=hostOrder.indexOf(item)+1;
    li.innerHTML='<div class="stripe" style="background:'+c+'"></div>'
      +'<span class="rnum" style="color:'+c+'">'+(i+1)+'</span>'
      +'<span class="iname">'+item+'</span>'
      +(correct?'':'<span class="res-host-pos">Host: #'+hostPos+'</span>')
      +'<span class="res-check">'+(correct?'‚úÖ':'‚ùå')+'</span>';
    ul.appendChild(li);
  });
}
function buildLeaderboard(cId,scored,maxScore,showRound){
  var lb=document.getElementById(cId);lb.innerHTML='';
  scored.forEach(function(p,i){
    var pct=maxScore>0?(showRound?p.score/5:p.total/maxScore)*100:0;
    var isMe=p.id===playerId;
    var div=document.createElement('div');div.className='lb-item';div.style.animationDelay=(i*.1)+'s';
    if(i===0)div.style.borderColor='#ffd700';else if(i===1)div.style.borderColor='#c0c0c0';else if(i===2)div.style.borderColor='#cd7f32';
    if(isMe)div.style.borderColor='var(--pink)';
    var sd=showRound?'<div class="lb-score">'+p.score+'/5</div><div class="lb-sub">total: '+p.total+'</div>':'<div class="lb-score">'+p.total+'</div>';
    div.innerHTML='<div class="lb-pos">'+(i<3?TROPHIES[i]:i+1)+'</div>'
      +'<div style="flex:1"><div class="lb-name">'+p.name+(isMe?' <span style="color:var(--pink);font-size:10px;">(you)</span>':'')+'</div>'
      +'<div class="bar-bg"><div class="bar" style="width:0" data-pct="'+pct+'"></div></div></div>'
      +'<div style="text-align:right;">'+sd+'</div>';
    lb.appendChild(div);
  });
  setTimeout(function(){document.querySelectorAll('.bar').forEach(function(b){b.style.width=b.dataset.pct+'%';});},300);
}

// ‚îÄ‚îÄ LANDING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleJoinBox(){
  var box=document.getElementById('join-box');box.classList.toggle('hidden');
  if(!box.classList.contains('hidden'))setTimeout(function(){document.getElementById('join-code').focus();},50);
}
function joinAndGo(){
  var code=document.getElementById('join-code').value.replace(/\s/g,'').toUpperCase();
  if(!code){showToast('Enter a room code!',true);return;}
  roomId=code;showPage('name-screen');
  setTimeout(function(){document.getElementById('player-name-input').focus();},50);
}

// ‚îÄ‚îÄ HOST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function goHost(){
  isHost=true;roomId=Math.random().toString(36).slice(2,8).toUpperCase();
  db.ref('rooms/'+roomId).set({status:'lobby',currentRound:0,hostOrder:null,revealed:false,categoryIndex:null,usedCats:[],finalResults:false})
    .then(setupHostLobby).catch(function(e){showToast('Firebase error: '+e.message,true);});
}
function setupHostLobby(){
  showPage('host-lobby');
  document.getElementById('room-code-display').textContent=roomId;
  var joinUrl=BASE_URL+'?join='+roomId;
  document.getElementById('join-url-text').textContent=joinUrl;
  document.getElementById('qr-inner').innerHTML='';
  new QRCode(document.getElementById('qr-inner'),{text:joinUrl,width:170,height:170,colorDark:'#000',colorLight:'#fff'});
  db.ref('rooms/'+roomId+'/players').on('value',function(snap){
    var players=snap.val()||{},entries=Object.entries(players);
    document.getElementById('pcnt').textContent=entries.length+' player'+(entries.length!==1?'s':'');
    var list=document.getElementById('player-list');
    if(!entries.length){list.innerHTML='<div class="no-players">Waiting for players‚Ä¶</div>';return;}
    list.innerHTML='';
    entries.forEach(function(e,i){
      var div=document.createElement('div');div.className='player-item';
      div.innerHTML='<div class="p-avatar">'+AVATARS[i%AVATARS.length]+'</div>'
        +'<span class="p-name">'+(e[1].name||e[0])+'</span>'
        +'<span class="p-score">'+(e[1].totalScore||0)+' pts</span>'
        +'<div class="pulse-dot"></div>';
      list.appendChild(div);
    });
    document.getElementById('rounds-summary').textContent=currentRound>0?'Completed '+currentRound+' round'+(currentRound!==1?'s':'')+' so far':'';
  });
}
function goPickCategory(){
  db.ref('rooms/'+roomId+'/usedCats').once('value').then(function(snap){
    usedCatIndexes=snap.val()||[];selectedCatIndex=null;
    document.getElementById('start-round-btn').disabled=true;
    document.getElementById('cat-search-input').value='';
    document.getElementById('pick-round-label').textContent='Round '+(currentRound+1);
    buildCategoryGrid('');showPage('host-pick-screen');
  });
}
function buildCategoryGrid(filter){
  var grid=document.getElementById('cat-grid');grid.innerHTML='';var f=filter.toLowerCase();
  CATEGORIES.forEach(function(cat,idx){
    var searchStr=(cat.type+' '+cat.name+' '+cat.items.join(' ')).toLowerCase();
    if(f&&searchStr.indexOf(f)===-1)return;
    var used=usedCatIndexes.indexOf(idx)!==-1;
    var div=document.createElement('div');
    div.className='cat-card'+(used?' used':'')+(selectedCatIndex===idx?' selected':'');
    div.innerHTML='<div class="cat-type">'+(TYPE_EMOJI[cat.type]||'üå∏')+' '+cat.type+'</div>'
      +'<div class="cat-name">'+cat.name+'</div>'
      +'<div class="cat-items">'+cat.items.join(' ¬∑ ')+'</div>';
    if(!used)div.onclick=function(){
      selectedCatIndex=idx;
      document.querySelectorAll('.cat-card').forEach(function(c){c.classList.remove('selected');});
      div.classList.add('selected');document.getElementById('start-round-btn').disabled=false;
    };
    grid.appendChild(div);
  });
}
function filterCategories(){buildCategoryGrid(document.getElementById('cat-search-input').value);}
function startRound(){
  if(selectedCatIndex===null)return;
  currentCategoryIndex=selectedCatIndex;currentRound++;
  var newUsed=usedCatIndexes.concat([selectedCatIndex]);
  var cat=CATEGORIES[currentCategoryIndex];
  db.ref('rooms/'+roomId+'/players').once('value').then(function(snap){
    var players=snap.val()||{},updates={};
    Object.keys(players).forEach(function(pid){updates['rooms/'+roomId+'/players/'+pid+'/order']=null;});
    updates['rooms/'+roomId+'/status']='playing';
    updates['rooms/'+roomId+'/currentRound']=currentRound;
    updates['rooms/'+roomId+'/categoryIndex']=currentCategoryIndex;
    updates['rooms/'+roomId+'/hostOrder']=null;
    updates['rooms/'+roomId+'/revealed']=false;
    updates['rooms/'+roomId+'/finalResults']=false;
    updates['rooms/'+roomId+'/usedCats']=newUsed;
    db.ref().update(updates).then(function(){
      showPage('host-game-screen');
      document.getElementById('host-round-badge').textContent='Round '+currentRound;
      document.getElementById('host-cat-label').textContent=(TYPE_EMOJI[cat.type]||'üå∏')+' '+cat.name;
      document.getElementById('lock-btn').disabled=false;
      document.getElementById('lock-msg').textContent='';
      document.getElementById('reveal-wrap').classList.add('hidden');
      initBoard('host',cat.items.slice());
    }).catch(function(e){showToast('Error: '+e.message,true);});
  });
}
function lockHostOrder(){
  if(!isBoardFull('host')){showToast('Place all 5 items in the slots first! üëÜ',true);return;}
  var order=getBoardOrder('host');
  db.ref('rooms/'+roomId+'/hostOrder').set(order).then(function(){
    document.getElementById('lock-btn').disabled=true;
    document.getElementById('lock-msg').textContent='‚úÖ Locked! Waiting for players to submit‚Ä¶';
    document.getElementById('reveal-wrap').classList.remove('hidden');
    showToast('Order locked! üîí');
    db.ref('rooms/'+roomId+'/players').on('value',function(snap){
      var players=snap.val()||{},entries=Object.entries(players);
      var prog=document.getElementById('players-progress-host');prog.innerHTML='';
      entries.forEach(function(e){
        var div=document.createElement('div');div.className='pp-item';
        var sub=e[1].order&&e[1].order.length>0;
        div.innerHTML='<span>'+AVATARS[0]+'</span><span>'+(e[1].name||e[0])+'</span>'
          +(sub?'<span class="pp-submitted">‚úÖ Submitted</span>':'<span class="pp-waiting">‚è≥ Ranking‚Ä¶</span>');
        prog.appendChild(div);
      });
    });
  }).catch(function(e){showToast('Error: '+e.message,true);});
}
function revealRound(){
  db.ref('rooms/'+roomId).update({revealed:true,status:'roundEnd'}).then(showRoundResults);
}

// ‚îÄ‚îÄ PLAYER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function confirmName(){
  var n=document.getElementById('player-name-input').value.trim();
  if(!n){showToast('Enter a nickname!',true);return;}
  playerName=n;
  db.ref('rooms/'+roomId+'/players/'+playerId).set({name:playerName,order:null,totalScore:0})
    .then(function(){
      document.getElementById('wait-code').textContent=roomId;
      showPage('waiting-screen');setupPlayerListeners();
    }).catch(function(e){showToast('Could not join: '+e.message+' ‚Äî fix Firebase rules!',true);});
}
function setupPlayerListeners(){
  db.ref('rooms/'+roomId+'/status').on('value',function(snap){
    var status=snap.val();
    if(status==='playing'){
      playerSubmitted=false;
      db.ref('rooms/'+roomId).once('value').then(function(rs){
        var data=rs.val();if(!data)return;
        currentRound=data.currentRound||1;currentCategoryIndex=data.categoryIndex;
        showPlayerGame(data);
      });
    }
    if(status==='roundEnd'){var cur=document.querySelector('.page:not(.hidden)');if(!cur||cur.id!=='round-results-screen')showRoundResults();}
    if(status==='lobby'){
      document.getElementById('wait-info').textContent='Waiting for next round‚Ä¶';
      document.getElementById('wait-pts').textContent=playerTotalScore>0?'‚≠ê Your total: '+playerTotalScore+' pts':'';
      showPage('waiting-screen');
    }
  });
  db.ref('rooms/'+roomId+'/revealed').on('value',function(snap){if(snap.val()===true)showRoundResults();});
  db.ref('rooms/'+roomId+'/finalResults').on('value',function(snap){if(snap.val()===true)showFinalResults();});
}
function showPlayerGame(data){
  var cat=CATEGORIES[data.categoryIndex];if(!cat)return;
  document.getElementById('player-round-badge').textContent='Round '+(data.currentRound||1);
  document.getElementById('player-pts-badge').textContent=playerTotalScore>0?playerTotalScore+' pts':'';
  document.getElementById('player-cat-label').textContent=(TYPE_EMOJI[cat.type]||'üå∏')+' '+cat.name;
  showPage('player-game-screen');
  var shuffled=cat.items.slice().sort(function(){return Math.random()-.5;});
  initBoard('player',shuffled);
  document.getElementById('submit-btn').classList.remove('hidden');
  document.getElementById('sub-banner').classList.add('hidden');
}
function submitOrder(){
  if(playerSubmitted){showToast('Already submitted!');return;}
  if(!isBoardFull('player')){showToast('Place all 5 items in the slots first! üëÜ',true);return;}
  var order=getBoardOrder('player');
  db.ref('rooms/'+roomId+'/players/'+playerId+'/order').set(order).then(function(){
    playerSubmitted=true;
    document.getElementById('submit-btn').classList.add('hidden');
    document.getElementById('sub-banner').classList.remove('hidden');
    showToast('Submitted! üå∏');
  }).catch(function(e){showToast('Submit failed: '+e.message,true);});
}

// ‚îÄ‚îÄ ROUND RESULTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showRoundResults(){
  db.ref('rooms/'+roomId).once('value').then(function(snap){
    var data=snap.val();if(!data||!data.hostOrder)return;
    var hostOrder=data.hostOrder,players=data.players||{},cat=CATEGORIES[data.categoryIndex]||{};
    currentRound=data.currentRound||currentRound;
    var scored=Object.entries(players).map(function(e){
      var id=e[0],p=e[1],score=0;
      if(p.order)p.order.forEach(function(item,i){if(item===hostOrder[i])score++;});
      return{id:id,name:p.name||id,score:score,total:(p.totalScore||0)+score};
    }).sort(function(a,b){return b.score-a.score;});
    var updates={};scored.forEach(function(p){updates['rooms/'+roomId+'/players/'+p.id+'/totalScore']=p.total;});
    db.ref().update(updates);
    var myEntry=scored.find(function(s){return s.id===playerId;});
    if(myEntry)playerTotalScore=myEntry.total;
    showPage('round-results-screen');
    document.getElementById('rr-title').textContent='Round '+currentRound+' Results';
    document.getElementById('rr-cat-label').textContent=(TYPE_EMOJI[cat.type]||'üå∏')+' '+(cat.name||'');
    buildStaticList('rr-host-list',hostOrder);
    var myP=players[playerId];
    if(myP&&myP.order&&!isHost){
      document.getElementById('player-own-results').classList.remove('hidden');
      document.getElementById('rr-your-score').textContent=(myEntry?myEntry.score:0)+'/5';
      buildResultList('player-result-list',myP.order,hostOrder);
    }else{document.getElementById('player-own-results').classList.add('hidden');}
    buildLeaderboard('rr-lb-list',scored,5,true);
    var btns=document.getElementById('rr-buttons');btns.innerHTML='';
    if(isHost){
      var nb=document.createElement('button');nb.className='btn btn-primary';nb.textContent='Next Round ‚Üí';nb.onclick=goPickCategory;btns.appendChild(nb);
      var eb=document.createElement('button');eb.className='btn btn-outline';eb.textContent='End Game & See Final Results';
      eb.onclick=function(){db.ref('rooms/'+roomId+'/finalResults').set(true).then(showFinalResults);};btns.appendChild(eb);
    }else{
      var p=document.createElement('p');p.style.cssText='color:var(--muted);font-size:12px;';p.textContent='‚è≥ Waiting for host to start next round‚Ä¶';btns.appendChild(p);
    }
  });
}

// ‚îÄ‚îÄ FINAL RESULTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showFinalResults(){
  db.ref('rooms/'+roomId+'/players').once('value').then(function(snap){
    var players=snap.val()||{};
    var scored=Object.entries(players).map(function(e){return{id:e[0],name:e[1].name||e[0],total:e[1].totalScore||0};}).sort(function(a,b){return b.total-a.total;});
    showPage('final-results-screen');
    if(scored.length>0){
      document.getElementById('winner-name').textContent=scored[0].name;
      document.getElementById('winner-pts').textContent=scored[0].total+' total points across '+currentRound+' round'+(currentRound!==1?'s':'');
    }
    buildLeaderboard('final-lb-list',scored,scored.length>0?scored[0].total:1,false);
  });
}

// ‚îÄ‚îÄ URL AUTO-JOIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
var urlCode=new URLSearchParams(location.search).get('join');
if(urlCode){
  roomId=urlCode.toUpperCase();
  document.getElementById('join-code').value=roomId;
  document.getElementById('join-box').classList.remove('hidden');
  showPage('name-screen');
  setTimeout(function(){document.getElementById('player-name-input').focus();},50);
}
</script>
</body>
</html>
